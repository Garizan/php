
# Лабораторная работа №4 — Лабораторная работа №4. Использование массивов и функций

## Цель работы
Закрепить навыки работы с массивами в PHP, написания пользовательских функций, сортировки и поиска данных, а также вывода результатов в HTML-таблицу. Дополнительно — реализовать простую галерею изображений на основе файлов в папке.

---

## Задание
1. Создать массив транзакций (ассоциативные массивы).
2. Реализовать функции:
   - подсчёт общей суммы транзакций;
   - поиск транзакций по части строки в описании;
   - поиск транзакции по ID (через `array_filter`);
   - подсчёт количества дней с момента транзакции;
   - добавление новой транзакции;
   - сортировка транзакций по дате;
   - сортировка транзакций по сумме (по убыванию).
3. Отобразить транзакции в таблице и вывести итоговую сумму.
4. Выполнить проверку работы функций (тестовый вывод).
5. Реализовать галерею изображений из папки `image/` (показывать только `.jpeg`).

---

## Структура проекта
```

lab4/
├─ index.php
└─ image/
├─ 1.jpeg
├─ 2.jpeg
└─ ...

````

---

## Описание данных
В начале файла объявлен массив `$transactions`, где каждая транзакция содержит поля:

- `id` — уникальный идентификатор
- `date` — дата в формате `YYYY-MM-DD`
- `amount` — сумма (float)
- `description` — описание транзакции
- `merchant` — получатель/магазин

Пример элемента:
```php
[
  "id" => 1,
  "date" => "2025-01-01",
  "amount" => 100.00,
  "description" => "Payment for groceries",
  "merchant" => "SuperMart",
]
````

---

## Описание функций

### 1) `calculateTotalAmount(array $transactions): float`

**Назначение:** вычисляет общую сумму всех транзакций.
**Логика:** проходит по массиву и суммирует поле `amount`.

---

### 2) `findTransactionByDescription(string $descriptionPart, array $transactions): array`

**Назначение:** поиск транзакций по части строки в поле `description`.
**Логика:** используется `stripos()` для поиска без учёта регистра.
**Результат:** возвращает массив всех подходящих транзакций.

---

### 3) `findTransactionById(int $id, array $transactions): ?array`

**Назначение:** поиск транзакции по `id`.
**Логика:** применяется `array_filter()` и стрелочная функция.
**Результат:** возвращает найденную транзакцию или `null`, если не найдено.

---

### 4) `daysSinceTransaction(string $date): int`

**Назначение:** вычисляет количество дней между датой транзакции и сегодняшним днём.
**Логика:** через `DateTime`, `diff()` и `days`. Возвращается абсолютное значение.

---

### 5) `addTransaction(int $id, string $date, float $amount, string $description, string $merchant): void`

**Назначение:** добавляет новую транзакцию в глобальный массив `$transactions`.
**Особенность:** используется `global $transactions`.

В работе добавляется транзакция:

```php
addTransaction(6, "2024-03-10", 250.00, "Online course", "EduPlatform");
```

---

### 6) `sortByDate(array $transactions): array`

**Назначение:** сортирует транзакции по дате (по возрастанию).
**Логика:** `usort()`, сравнение через `DateTime` и оператор `<=>`.
**Результат:** возвращает новый отсортированный массив.

---

### 7) `sortByAmountDesc(array $transactions): array`

**Назначение:** сортирует транзакции по сумме (по убыванию).
**Логика:** `usort()`, сравнение `$b['amount'] <=> $a['amount']`.

---

## Формирование данных для вывода

1. После добавления новой транзакции выполняется сортировка:

```php
$transactionsToShow = sortByDate($transactions);
```

2. Затем считается итог:

```php
$totalAmount = calculateTotalAmount($transactionsToShow);
```

3. В HTML-таблице для каждой строки дополнительно выводится:

* количество дней с момента транзакции: `daysSinceTransaction($transaction['date'])`

В конце таблицы отдельной строкой выводится итоговая сумма.

---

## Блок тестирования функций

В секции **"Проверка функций"** выводятся результаты работы функций:

1. `calculateTotalAmount()` — печать общей суммы.
2. `findTransactionByDescription("Dinner", $transactions)` — печать найденных элементов через `print_r`.
3. `findTransactionById(2, $transactions)` — вывод через `var_dump`.
4. `daysSinceTransaction()` — пример для транзакции с `ID=1`.
5. `sortByDate()` — вывод массива после сортировки по дате.
6. `sortByAmountDesc()` — вывод массива после сортировки по сумме (убывание).

---

## Галерея изображений

Реализовано чтение папки:

```php
$dir = 'image/';
$files = is_dir($dir) ? scandir($dir) : [];
```

Далее в HTML выполняется перебор файлов:

* пропускаются `.` и `..`
* выводятся только файлы с расширением `.jpeg`

Каждое изображение отображается как:

```php
<img src="image/имя_файла.jpeg" alt="image">
```

---

## Результат

* Отображается таблица транзакций (уже отсортирована по дате).
* Для каждой транзакции выводится количество дней с момента её совершения.
* В таблице присутствует строка **Итого** с суммой всех транзакций.
* В секции тестов выводятся результаты работы всех функций.
* В секции галереи отображаются изображения `.jpeg` из папки `image/`.

---

## Вывод

В ходе лабораторной работы были реализованы операции обработки массива транзакций (поиск, сортировка, добавление, вычисления) и вывод результатов в HTML. Дополнительно реализовано чтение файлов из директории и отображение изображений в виде галереи.
